<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <title>Daily Home Kid Challenge 2.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <link rel="manifest" href="manifest.json"/>
  <link rel="stylesheet" href="style.css?v=3.6"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="puzzle-utils.js"></script>
</head>

<body>

  <!-- ================= HEADER ================= -->
  <header class="app-header">
    <button class="menu-btn" aria-label="Ouvrir le menu">&#9776;</button>
    <h1>Daily Home Kid Challenge</h1>
  </header>

<!-- ================= SIDEBAR ================= -->
<nav class="sidebar" id="sidebar">
  <h2>Mon espace Famille</h2>
  <div class="sidebar-grabber"></div>

  <div class="sidebar-content">
    <ul class="nav-list">
      <li onclick="showView('vue-accueil')">🏠 Accueil</li>
    </ul>

    <input id="importChildInput" type="file" accept="application/json" style="display:none" onchange="handleImportChild(event)">
    <ul id="childrenList" class="nav-list children-list"></ul>
  </div>

  <!-- ======== FOOTER AVEC ACCORDÉON PARAMÈTRES ======== -->
  <div class="sidebar-footer">

    <!-- Accordéon Paramètres -->
    <li class="child-accordion" id="parametresAccordion">
      <h3>
        <span>⚙️ Paramètres</span>
        <span class="arrow">▼</span>
      </h3>
      <ul class="options">
        <li class="sidebar-link" onclick="addChild()">➕ Ajouter un enfant</li>
        <li class="sidebar-link" onclick="document.getElementById('importChildInput').click()">📥 Importer un enfant</li>
        <li class="sidebar-link" onclick="importExample()">🧪 Importer l'exemple</li>
        <li id="btnResetChildren" class="sidebar-link">♻️ Réinitialiser les enfants</li>
        <li id="btnPurgeAll" class="sidebar-link">🗑️ Purge totale</li>
        <li><a href="about.html" class="sidebar-link">📘 À propos</a></li>
        <li><a href="install.html" class="sidebar-link">⬇️ Installer l’app</a></li>
      </ul>
    </li>

    <hr class="sidebar-separator">
  </div>
</nav>

<!-- Overlay -->
<div id="overlay"></div>


  <!-- Overlay -->
  <div id="overlay"></div>

  <!-- ================= VUES ================= -->
  
<main class="view active" id="vue-accueil">
  <section class="home-hero">
    <h2>Bienvenue dans le Daily Home Kid Challenge 🎉</h2>
    <p>Un jeu familial pour motiver les enfants à accomplir leurs petites missions du quotidien, 
    suivre leurs progrès et gagner des récompenses amusantes !</p>
    <img src="img/puzzle.png" alt="Illustration d'accueil" class="home-illustration">
  </section>
</main>

  
  <main class="view active" id="vue-jour">
    <div class="view-header">
      <div class="calendar">
        <button id="btnPrev">&lt;</button>
        <div class="calendar-title"><h2 id="weekTitle">1 Octobre 2025</h2></div>
        <button id="btnNext">&gt;</button>
      </div>

<div class="child-and-day">
  <p class="current-child" id="currentChild_day">—</p>
  <span class="day-label" id="currentDayLabel">—</span>
</div>

<div class="tabs">
  <button class="tab active" onclick="switchTab(this,'vue-jour')">Jour</button>
  <button class="tab" onclick="switchTab(this,'vue-mois')">Mois</button>
</div>

    </div>
    <div class="table-wrapper">
      <table>
        <thead><tr><th>Tâche</th><th>Statut</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

<!-- ===== Indicateurs d'avancement (Jour + Semaine + Mois) ===== -->
<div class="radial-trio">
  <div class="radial" id="radial-jour"></div>
  <div class="radial" id="radial-semaine"></div>
  <div class="radial" id="radial-mois"></div>
</div>

<!-- ===== Récompenses (SEMAINE) ===== -->
<div id="rewardBannerW1" class="reward-banner hidden" aria-live="polite"></div>
<div id="rewardBannerW2" class="reward-banner hidden" aria-live="polite"></div>

<!-- ===== / Indicateurs ===== -->
	
  </main>

  <main class="view" id="vue-mois">
    <div class="view-header">
      <div class="calendar">
        <button id="btnPrevMonth">&lt;</button>
        <div class="calendar-title"><h2 id="monthTitle">Mois</h2></div>
        <button id="btnNextMonth">&gt;</button>
      </div>
      <p class="current-child" id="currentChild_month">—</p>
      <div class="tabs">
        <button class="tab" onclick="switchTab(this,'vue-jour')">Jour</button>
        <button class="tab active" onclick="switchTab(this,'vue-mois')">Mois</button>
      </div>
    </div>
    <div class="calendar-month"></div>
  </main>

  <main class="view result-view" id="vue-resultats">
    <h2 id="childTitle">Résultats - Enfant</h2>
    <div class="result-actions">
      <button id="btnUploadImage" class="upload">📷</button>
      <button id="btnDeleteImage" class="delete">🗑️</button>
      <input type="file" id="imageInput" accept="image/*" style="display:none;" onchange="handleImageUpload(event)">
    </div>
    <div class="puzzle-container">
      <img src="img/puzzle.png" alt="Puzzle" class="puzzle-image">
      <div class="puzzle-mask" id="puzzleMask"></div>
    </div>
    <div class="result" id="resultat"></div>
    <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>
  </main>

  <main class="view" id="vue-historique">
    <h2>📖 Historique</h2>
    <table>
      <thead><tr><th>Semaine</th><th>% Réalisé</th><th>Récompense</th><th>Palier</th></tr></thead>
      <tbody id="historiqueBody"></tbody>
    </table>
    <div id="chartContainer" style="height:280px;margin-top:16px;">
      <canvas id="historyChart"></canvas>
    </div>
  </main>

  <main class="view" id="vue-nom-avatar">
    <div class="view-header">
      <button onclick="openMenu()" class="back-btn">⬅ Retour</button>
      <h2>Nom & Avatar</h2>
    </div>
    <div class="param-section">
      <div class="avatar-frame">
        <div class="avatar-wrapper">
          <img id="avatarPreview" src="img/default.png" alt="Avatar" class="avatar-large">
          <button type="button" class="delete-avatar-btn" onclick="deleteAvatar()">🗑️</button>
        </div>
      </div>
      <input type="file" id="inputAvatar" accept="image/*">
      <p id="avatarFileName" class="avatar-filename">Avatar par défaut</p>
      <label for="inputChildName">Nom de l’enfant :</label>
      <input type="text" id="inputChildName" placeholder="Entrez le prénom">
      <label for="inputChildAge">Âge :</label>
      <input type="number" id="inputChildAge" min="0" max="20" placeholder="Entrez l’âge">
      <label>Genre :</label>
      <div class="gender-options">
        <label><input type="radio" name="childGender" value="fille"> Fille</label>
        <label><input type="radio" name="childGender" value="garçon"> Garçon</label>
        <label><input type="radio" name="childGender" value="non-defini" checked> Non défini</label>
      </div>
    </div>
    <div class="param-actions">
      <button onclick="majUI()">❌ Annuler</button>
    </div>
  </main>

  <main class="view" id="vue-taches">
    <div class="view-header">
      <button onclick="openMenu()" class="back-btn">⬅ Retour</button>
      <h2>📋 Gestion des tâches</h2>
	  <p class="current-child" id="currentChild_tasks">—</p>
    </div>
    <div class="param-section">
      <div class="task-add">
        <input type="text" id="newTaskName" placeholder="Nouvelle tâche">
        <button class="save" onclick="addTask()">➕ Ajouter</button>
      </div>
      <ul id="taskList"></ul>
    </div>
    <div class="param-actions">
      <button onclick="majUI()">❌ Annuler</button>
    </div>
  </main>

  <main class="view" id="vue-recompenses">
    <div class="view-header">
      <button onclick="openMenu()" class="back-btn">⬅ Retour</button>
      <h2>🎁 Récompenses</h2>
	  <p class="current-child" id="currentChild_rewards">—</p>

    </div>
   
<!-- 🔹 Paliers modifiables directement -->
<div class="reward-summary editable">
  <div class="reward-box">
    <h4>Palier 1</h4>
    <label>Seuil (%) :</label>
    <input type="number" id="summaryThreshold1" min="0" max="100" step="1">
    <label>Récompense :</label>
    <input type="text" id="summaryReward1" placeholder="Ex : Choisir un dessin animé">
  </div>
  <div class="reward-box">
    <h4>Palier 2</h4>
    <label>Seuil (%) :</label>
    <input type="number" id="summaryThreshold2" min="0" max="100" step="1">
    <label>Récompense :</label>
    <input type="text" id="summaryReward2" placeholder="Ex : Sortie au parc">
  </div>
</div>


	<!-- 🔹 Récompenses personnalisées -->
<div class="param-section">
  <h5>🎯 Récompenses personnalisées par semaine</h5>
  <label for="customWeek">Semaine (numéro-année) :</label>
  <input type="text" id="customWeek" placeholder="Ex : 42-2025">

  <label for="customReward">Récompense :</label>
  <input type="text" id="customReward" placeholder="Ex : Sortie cinéma">

  <label for="customPalier">Palier :</label>
  <select id="customPalier">
    <option value="Palier 1">Palier 1</option>
    <option value="Palier 2">Palier 2</option>
    <option value="-">Autre</option>
  </select>

  <button class="save" onclick="addWeeklyReward()">➕ Ajouter</button>
</div>

<table id="customRewardsTable">
  <thead>
    <tr><th>Semaine</th><th>Récompense</th><th>Palier</th><th></th></tr>
  </thead>
  <tbody></tbody>
</table>

    <div class="param-actions">
      <button onclick="majUI()">❌ Annuler</button>
      <button class="save" onclick="saveRewards()">💾 Enregistrer</button>
    </div>
	<div id="toast" class="toast"></div>
  </main>

  <!-- ================= JS ================= -->
  <script src="index.js?v=3.7"></script>

<!-- ✅ Vérification simple sans double attachement -->
<script>
window.addEventListener("load", () => {
  const resetBtn = document.getElementById("btnResetChildren");
  const purgeBtn = document.getElementById("btnPurgeAll");

  if (resetBtn) {
    console.log("✅ Bouton 'Réinitialiser les enfants' détecté dans le DOM.");
  } else {
    console.warn("⚠️ Bouton 'Réinitialiser les enfants' introuvable.");
  }

  if (purgeBtn) {
    console.log("✅ Bouton 'Purge totale' détecté dans le DOM.");
  } else {
    console.warn("⚠️ Bouton 'Purge totale' introuvable.");
  }
});
</script>



  <!-- 🔄 Service Worker Update Notification -->
  <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./service-worker.js').then(reg => {
      console.log('[SW] Enregistré avec succès.');
      reg.addEventListener('updatefound', () => {
        const newWorker = reg.installing;
        newWorker.addEventListener('statechange', () => {
          if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
            showUpdateBanner(reg);
          }
        });
      });
    }).catch(err => console.warn('[SW] Erreur d’enregistrement :', err));
  }
  </script>

</body>
</html>
