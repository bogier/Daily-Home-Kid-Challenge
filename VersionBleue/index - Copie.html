<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <title>Daily Home Kid Challenge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="manifest" href="manifest.json"/>
  <link rel="stylesheet" href="style.css?v=4.4.0"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="puzzle-utils.js"></script>
</head>

<body>
  <!-- Header externe -->
  <div id="header-container"></div>

  <!-- Navigation calendrier -->
  <div class="calendar">
    <button id="btnPrev" class="btn btn-small btn-icon">◀</button>
    <div id="calendar"></div>
    <button id="btnNext" class="btn btn-small btn-icon">▶</button>
  </div>
  <p id="lockMessage"></p>

  <main>
    <p id="modeLabel" style="text-align:center;font-weight:bold;margin:0.5rem 0;"></p>

    <!-- Modes de vue -->
    <div class="btn-row">
      <button id="btnVueSemaine" class="btn btn-small" data-mode="semaine" title="Semaine">📅</button>
      <button id="btnVueGlobale" class="btn btn-small" data-mode="globale" title="Globale">📊</button>
      <button id="btnVueJour" class="btn btn-small" data-mode="jour" title="Jour">☀️</button>
      <button id="btnVueAvancee" class="btn btn-small" data-mode="avancee" title="Résultat">✅</button>
    </div>

    <!-- Navigation enfant -->
    <div class="child-nav" style="flex-direction:column;gap:.1rem;">
      <div class="week-rewards" id="weekRewards"></div>
      <div class="separator"></div>
      <div style="display:flex;align-items:center;justify-content:center;gap:.6rem;">
        <button id="btnPrevChild" class="btn btn-small btn-icon">◀</button>
        <h2 id="childTitle">Tâches de ...</h2>
        <button id="btnNextChild" class="btn btn-small btn-icon">▶</button>
        <button id="btnToggleRecompenses" class="btn btn-small btn-icon">🎁</button>
      </div>
    </div>

    <!-- Tableau de tâches -->
    <div class="table-wrapper">
      <table id="tasksTable">
        <thead id="tasksHeader"></thead>
        <tbody id="tasks"></tbody>
      </table>
    </div>

    <!-- Boutons -->
    <div class="btn-group" style="text-align:center;display:flex;flex-wrap:wrap;gap:.5rem;justify-content:center;">
      <button id="btnHistorique" class="btn">📖 Historique</button>
      <button id="btnResetSemaine" class="btn btn-warning">♻️ Réinitialiser la semaine</button>
    </div>

    <!-- Résultats -->
    <div class="result" id="resultat"></div>

    <!-- Bonus / Malus -->
    <div class="bonus-malus">
      <label>Bonus : <input id="bonusInput" step="1" type="number" value="0"/></label>
      <label>Malus : <input id="malusInput" step="1" type="number" value="0"/></label>
    </div>

    <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>

    <!-- Historique -->
    <div id="historique" style="display:none;">
      <h2>📖 Historique</h2>
      <div class="tabs" style="text-align:center;margin-bottom:.5rem;">
        <button id="tabSemaine" class="btn btn-small">semaines</button>
        <button id="tabGlobale" class="btn btn-small">graphique</button>
        <button id="btnResetHistorique" class="btn btn-danger btn-small">🔄 Réinitialiser l’historique</button>
      </div>
      <table>
        <thead><tr><th>Semaine</th><th>% Réalisé</th><th>Récompense</th><th>Palier</th></tr></thead>
        <tbody id="historiqueBody"></tbody>
      </table>
      <div id="chartContainer" style="display:none;height:280px;margin-top:16px;">
        <canvas id="historyChart"></canvas>
      </div>
    </div>
  </main>

  <!-- Scripts -->
  <script src="common.js"></script>
  <script src="pwa.js"></script>
  <script src="index.js"></script>

  <!-- Injection header -->
  <script>
    fetch("header.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("header-container").innerHTML = html;
      });
  </script>
</body>
</html>
